window.WeatherWind=function(){function t(){return/android|blackberry|iemobile|ipad|iphone|ipod|opera mini|webos/i.test(navigator.userAgent)}function a(t){return null!==t&&void 0!==t}function e(t,a){return t-a*Math.floor(t/a)}function n(t,a,e,n,r,o,i){return i[0]*=o,i[1]*=o,i}function r(t,a,e,n,r,o){var i=1-t,u=1-a,l=i*u,f=t*u,c=i*a,s=t*a,d=e[0]*l+n[0]*f+r[0]*c+o[0]*s,h=e[1]*l+n[1]*f+r[1]*c+o[1]*s;return[d,h,Math.sqrt(d*d+h*h)]}function o(t,a){var e=t.data,n=a.data;return{header:t.header,data:function(t){return[e[t],n[t]]},interpolate:r}}function i(){var t=null,a=null,e=null;return C.forEach(function(n){switch(n.header.parameterCategory+","+n.header.parameterNumber){case"2,2":t=n;break;case"2,3":a=n;break;default:e=n}}),o(t,a)}function u(){function t(t,r){var i,c=e(t-o,360)/l,s=(u-r)/f,d=Math.floor(c),v=d+1,p=Math.floor(s),g=p+1;if(i=h[p]){var m=i[d],y=i[v];if(a(m)&&a(y)&&(i=h[g])){var M=i[d],w=i[v];if(a(M)&&a(w))return n.interpolate(c-d,s-p,m,y,M,w)}}return null}var n=i(C),r=n.header,o=r.lo1,u=r.la1,l=r.dx,f=r.dy,c=r.nx,s=r.ny,d=new Date(r.refTime);d.setHours(d.getHours()+r.forecastTime);for(var h=[],v=0,p=Math.floor(c*l)>=360,g=0;g<s;g++){for(var m=[],y=0;y<c;y++,v++)m[y]=n.data(v);p&&m.push(m[0]),h[g]=m}E={date:d,interpolate:t}}function l(t,a){var e=R[Math.round(t)];return e&&e[Math.round(a)]||S}function f(t){function a(t){for(var a=[],o=0;o<=D;o+=2){var i=w([t,o]);if(i){var u=i[0],l=i[1];if(isFinite(u)){var f=E.interpolate(u,l);f&&(f=n(e,u,l,t,o,W,f),a[o+1]=a[o]=f)}}}r[t+1]=r[t]=a}var e={},r=[],o=0;!function e(){for(var n=Date.now();o<k;)if(a(o),o+=2,Date.now()-n>1e3)return void setTimeout(e,25);R=r,t()}()}function c(){function t(){e.forEach(function(t){t.length=0}),n.forEach(function(t){t.age>J&&(l.randomize(t).age=0);var a=t.x,n=t.y,r=l(a,n);if(null===r[2])t.age=J;else{var o=a+r[0],i=n+r[1];null!==l(o,i)[2]?(t.xt=o,t.yt=i,e[0].push(t)):(t.x=o,t.y=i)}t.age+=1})}function a(){var t=y.globalCompositeOperation;y.globalCompositeOperation="destination-in",y.fillRect(0,0,k,D),y.globalCompositeOperation=t,y.lineWidth=z,y.strokeStyle=I,y.fillStyle=N,e.forEach(function(t,a){t.length>0&&(y.beginPath(),t.forEach(function(t){y.moveTo(t.x,t.y),y.lineTo(t.xt,t.yt),t.x=t.xt,t.y=t.yt}),y.stroke())})}for(var e=[[]],n=[],r=0;r<q;r++)n.push(l.randomize({age:Math.floor(Math.random()*J)+0}));!function e(){try{x=setTimeout(function(){requestAnimationFrame(e),t(),a()},1e3/G)}catch(t){console.error(t)}}()}function s(t){var a=t.particle;if(a){var e=a.canvas;e&&(k=e.width,D=e.height,y=e.getContext("2d"),z=a.lineWidth||A,I=a.lineColor||lineColor);var n=a.densityRatio;n>=0&&n<=1||(n=.5),F=n;var r=a.speedRatio;r>=0&&r<=1||(r=.5),W=H+(O-H)*r;var o=a.sizeRatio;o>=0&&o<=1||(o=.5);N="rgba(0,0,0,"+(L+(K-L)*o)+")"}var i=t.mask;if(i){var u=i.canvas;u&&(M=u.getContext("2d")),T=i.colors.map(function(t){var a=t[1]||"rgba(0, 0, 0, 0)",e=/rgba\((\d+),(\d+),(\d+),([\d.]+)\)/.exec(a.replace(/\s/g,""));if(e){var n=[parseInt(e[1]),parseInt(e[2]),parseInt(e[3]),Math.floor(255*parseFloat(e[4]))];return[t[0],n]}})}C=t.data||C,b=t.project,w=t.invert}function d(t){for(var a=[0,0,0,0],e=0,n=T.length-1;e<n;e++){var r=T[e],o=T[e+1];if(r[0]<=t&&t<o[0]){a=r[1];break}}return a}function h(){if(M){var t=new Date,a=M.getImageData(0,0,k,D),e=a.data;R.forEach(function(t,a){t.forEach(function(t,n){var r=t[2],o=d(r),i=4*(n*k+a);e[i]=o[0],e[i+1]=o[1],e[i+2]=o[2],e[i+3]=100})}),M.putImageData(a,0,0),console.log("mask takes",new Date-t,"ms")}}function v(a){if(p(),a&&(C=a),!C)throw new Error("please set data");if(y){var e=y.canvas;k=e.width,D=e.height,y.clearRect(0,0,k,D);q=k*D*(P+(j-P)*F),t()&&(q*=B),q=Math.round(q),console.log("particleCount =",q),console.log("speed =",W),console.log("alpha =",N)}M&&M.clearRect(0,0,k,D);var n=new Date;requestAnimationFrame(function(){u(),f(function(){console.log("deal data takes",new Date-n,"ms"),c(),h()})})}function p(){clearTimeout(x),l.release()}function g(t){C=t}function m(){return!!C}var y,M,w,b,x,k,D,C,E,R,T,I,N,z,F,W,q,A=1,O=.3,H=.02,S=[NaN,NaN,null],j=1/70,P=.002,B=.7,G=30,J=100,K=.98,L=.86,Q={};return l.release=function(){R=[]},l.randomize=function(t){var a,e,n=0;do{a=Math.round(Math.floor(Math.random()*k)),e=Math.round(Math.floor(Math.random()*D))}while(null===l(a,e)[2]&&n++<30);return t.x=a,t.y=e,t},Q.start=v,Q.stop=p,Q.config=s,Q.setData=g,Q.isReady=m,Q}();