window.WeatherWind=function(){function t(){return/android|blackberry|iemobile|ipad|iphone|ipod|opera mini|webos/i.test(navigator.userAgent)}function a(t){return null!==t&&void 0!==t}function n(t,a){return t-a*Math.floor(t/a)}function e(t,a,n,e,r,o,i){return i[0]*=o,i[1]*=o,i}function r(t,a,n,e,r,o){var i=1-t,f=1-a,u=i*f,l=t*f,c=i*a,s=t*a,d=n[0]*u+e[0]*l+r[0]*c+o[0]*s,h=n[1]*u+e[1]*l+r[1]*c+o[1]*s;return[d,h,Math.sqrt(d*d+h*h)]}function o(t,a){var n=t.data,e=a.data;return{header:t.header,data:function(t){return[n[t],e[t]]},interpolate:r}}function i(){var t=null,a=null,n=null;return E.forEach(function(e){switch(e.header.parameterCategory+","+e.header.parameterNumber){case"2,2":t=e;break;case"2,3":a=e;break;default:n=e}}),o(t,a)}function f(){function t(t,r){var i,c=n(t-o,360)/u,s=(f-r)/l,d=Math.floor(c),v=d+1,m=Math.floor(s),p=m+1;if(i=h[m]){var g=i[d],M=i[v];if(a(g)&&a(M)&&(i=h[p])){var y=i[d],b=i[v];if(a(y)&&a(b))return e.interpolate(c-d,s-m,g,M,y,b)}}return null}var e=i(E),r=e.header,o=r.lo1,f=r.la1,u=r.dx,l=r.dy,c=r.nx,s=r.ny,d=new Date(r.refTime);d.setHours(d.getHours()+r.forecastTime);for(var h=[],v=0,m=Math.floor(c*u)>=360,p=0;p<s;p++){for(var g=[],M=0;M<c;M++,v++)g[M]=e.data(v);m&&g.push(g[0]),h[p]=g}C={date:d,interpolate:t}}function u(t,a){var n=T[Math.round(t)];return n&&n[Math.round(a)]||R}function l(t){function a(t){for(var a=[],i=0;i<=D;i+=2){var f=b([t,i]);if(f){var u=f[0],l=f[1];if(isFinite(u)){var c=C.interpolate(u,l);c&&(c=e(n,u,l,t,i,r,c),a[i+1]=a[i]=c)}}}o[t+1]=o[t]=a}var n={},r=F,o=[],i=0;!function n(){for(var e=Date.now();i<k;)if(a(i),i+=2,Date.now()-e>1e3)return void setTimeout(n,25);T=o,t()}()}function c(){function a(){e.forEach(function(t){t.length=0}),o.forEach(function(t){t.age>A&&(u.randomize(t).age=0);var a=t.x,n=t.y,r=u(a,n);if(null===r[2])t.age=A;else{var o=a+r[0],i=n+r[1];null!==u(o,i)[2]?(t.xt=o,t.yt=i,e[0].push(t)):(t.x=o,t.y=i)}t.age+=1})}function n(){var t=M.globalCompositeOperation;M.globalCompositeOperation="destination-in",M.fillRect(0,0,k,D),M.globalCompositeOperation=t,e.forEach(function(t,a){t.length>0&&(M.beginPath(),t.forEach(function(t){M.moveTo(t.x,t.y),M.lineTo(t.xt,t.yt),t.x=t.xt,t.y=t.yt}),M.stroke())})}var e=[[]],r=Math.round(k*D*W);t()&&(r*=q);for(var o=[],i=0;i<r;i++)o.push(u.randomize({age:Math.floor(Math.random()*A)+0}));!function t(){try{x=setTimeout(function(){requestAnimationFrame(t),a(),n()},1e3/z)}catch(t){console.error(t)}}()}function s(t){var a=t.particle;if(a){var n=a.canvas;n&&(k=n.width,D=n.height,M=n.getContext("2d"),M.lineWidth=a.lineWidth||N,M.strokeStyle=a.lineColor||H,M.fillStyle=O)}var e=t.mask;if(e){var r=e.canvas;r&&(y=r.getContext("2d")),I=e.colors.map(function(t){var a=t[1]||"rgba(0, 0, 0, 0)",n=/rgba\((\d+),(\d+),(\d+),([\d.]+)\)/.exec(a.replace(/\s/g,""));if(n){var e=[parseInt(n[1]),parseInt(n[2]),parseInt(n[3]),Math.floor(255*parseFloat(n[4]))];return[t[0],e]}})}E=t.data,w=t.project,b=t.invert}function d(t){for(var a=[0,0,0,0],n=0,e=I.length-1;n<e;n++){var r=I[n],o=I[n+1];if(r[0]<=t&&t<o[0]){a=r[1];break}}return a}function h(){if(y){var t=new Date,a=y.getImageData(0,0,k,D),n=a.data;T.forEach(function(t,a){t.forEach(function(t,e){var r=t[2],o=d(r),i=4*(e*k+a);n[i]=o[0],n[i+1]=o[1],n[i+2]=o[2],n[i+3]=100})}),y.putImageData(a,0,0),console.log("mask takes",new Date-t,"ms")}}function v(t){if(m(),t&&(E=t),!E)throw new Error("please set data");y&&y.clearRect(0,0,k,D),M.clearRect(0,0,k,D);var a=new Date;requestAnimationFrame(function(){f(),l(function(){console.log("deal data takes",new Date-a,"ms"),c(),h()})})}function m(){clearTimeout(x),u.release()}function p(t){E=t}function g(){return!!E}var M,y,b,w,x,k,D,E,C,T,I,N=1,F=.15,R=[NaN,NaN,null],W=.01,q=.7,z=30,A=100,O="rgba(0, 0, 0, 0.97)",H="#ffffff",S={};return u.release=function(){T=[]},u.randomize=function(t){var a,n,e=0;do{a=Math.round(Math.floor(Math.random()*k)),n=Math.round(Math.floor(Math.random()*D))}while(null===u(a,n)[2]&&e++<30);return t.x=a,t.y=n,t},S.start=v,S.stop=m,S.config=s,S.setData=p,S.isReady=g,S}();