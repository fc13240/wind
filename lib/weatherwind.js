window.WeatherWind=function(){function t(){return/android|blackberry|iemobile|ipad|iphone|ipod|opera mini|webos/i.test(navigator.userAgent)}function a(t){return null!==t&&void 0!==t}function n(t,a){return t-a*Math.floor(t/a)}function e(t,a,n,e,r,o,i){return i[0]*=o,i[1]*=o,i}function r(t,a,n,e,r,o){var i=1-t,u=1-a,f=i*u,l=t*u,c=i*a,s=t*a,d=n[0]*f+e[0]*l+r[0]*c+o[0]*s,h=n[1]*f+e[1]*l+r[1]*c+o[1]*s;return[d,h,Math.sqrt(d*d+h*h)]}function o(t,a){var n=t.data,e=a.data;return{header:t.header,data:function(t){return[n[t],e[t]]},interpolate:r}}function i(){var t=null,a=null,n=null;return C.forEach(function(e){switch(e.header.parameterCategory+","+e.header.parameterNumber){case"2,2":t=e;break;case"2,3":a=e;break;default:n=e}}),o(t,a)}function u(){function t(t,r){var i,c=n(t-o,360)/f,s=(u-r)/l,d=Math.floor(c),v=d+1,m=Math.floor(s),g=m+1;if(i=h[m]){var p=i[d],M=i[v];if(a(p)&&a(M)&&(i=h[g])){var w=i[d],y=i[v];if(a(w)&&a(y))return e.interpolate(c-d,s-m,p,M,w,y)}}return null}var e=i(C),r=e.header,o=r.lo1,u=r.la1,f=r.dx,l=r.dy,c=r.nx,s=r.ny,d=new Date(r.refTime);d.setHours(d.getHours()+r.forecastTime);for(var h=[],v=0,m=Math.floor(c*f)>=360,g=0;g<s;g++){for(var p=[],M=0;M<c;M++,v++)p[M]=e.data(v);m&&p.push(p[0]),h[g]=p}E={date:d,interpolate:t}}function f(t,a){var n=T[Math.round(t)];return n&&n[Math.round(a)]||z}function l(t){function a(t){for(var a=[],i=0;i<=D;i+=2){var u=y([t,i]);if(u){var f=u[0],l=u[1];if(isFinite(f)){var c=E.interpolate(f,l);c&&(c=e(n,f,l,t,i,r,c),a[i+1]=a[i]=c)}}}o[t+1]=o[t]=a}var n={},r=q,o=[],i=0;!function n(){for(var e=Date.now();i<k;)if(a(i),i+=2,Date.now()-e>1e3)return void setTimeout(n,25);T=o,t()}()}function c(){function a(){e.forEach(function(t){t.length=0}),o.forEach(function(t){t.age>S&&(f.randomize(t).age=0);var a=t.x,n=t.y,r=f(a,n);if(null===r[2])t.age=S;else{var o=a+r[0],i=n+r[1];null!==f(o,i)[2]?(t.xt=o,t.yt=i,e[0].push(t)):(t.x=o,t.y=i)}t.age+=1})}function n(){var t=M.globalCompositeOperation;M.globalCompositeOperation="destination-in",M.fillRect(0,0,k,D),M.globalCompositeOperation=t,M.lineWidth=R,M.strokeStyle=N,M.fillStyle=F,e.forEach(function(t,a){t.length>0&&(M.beginPath(),t.forEach(function(t){M.moveTo(t.x,t.y),M.lineTo(t.xt,t.yt),t.x=t.xt,t.y=t.yt}),M.stroke())})}var e=[[]],r=Math.round(k*D*A);t()&&(r*=O);for(var o=[],i=0;i<r;i++)o.push(f.randomize({age:Math.floor(Math.random()*S)+0}));!function t(){try{x=setTimeout(function(){requestAnimationFrame(t),a(),n()},1e3/H)}catch(t){console.error(t)}}()}function s(t){var a=t.particle;if(a){var n=a.canvas;n&&(k=n.width,D=n.height,M=n.getContext("2d"),R=a.lineWidth||W,N=a.lineColor||lineColor,F=j)}var e=t.mask;if(e){var r=e.canvas;r&&(w=r.getContext("2d")),I=e.colors.map(function(t){var a=t[1]||"rgba(0, 0, 0, 0)",n=/rgba\((\d+),(\d+),(\d+),([\d.]+)\)/.exec(a.replace(/\s/g,""));if(n){var e=[parseInt(n[1]),parseInt(n[2]),parseInt(n[3]),Math.floor(255*parseFloat(n[4]))];return[t[0],e]}})}C=t.data,b=t.project,y=t.invert}function d(t){for(var a=[0,0,0,0],n=0,e=I.length-1;n<e;n++){var r=I[n],o=I[n+1];if(r[0]<=t&&t<o[0]){a=r[1];break}}return a}function h(){if(w){var t=new Date,a=w.getImageData(0,0,k,D),n=a.data;T.forEach(function(t,a){t.forEach(function(t,e){var r=t[2],o=d(r),i=4*(e*k+a);n[i]=o[0],n[i+1]=o[1],n[i+2]=o[2],n[i+3]=100})}),w.putImageData(a,0,0),console.log("mask takes",new Date-t,"ms")}}function v(t){if(m(),t&&(C=t),!C)throw new Error("please set data");if(M){var a=M.canvas;k=a.width,D=a.height,M.clearRect(0,0,k,D)}w&&w.clearRect(0,0,k,D);var n=new Date;requestAnimationFrame(function(){u(),l(function(){console.log("deal data takes",new Date-n,"ms"),c(),h()})})}function m(){clearTimeout(x),f.release()}function g(t){C=t}function p(){return!!C}var M,w,y,b,x,k,D,C,E,T,I,N,F,R,W=1,q=.15,z=[NaN,NaN,null],A=.01,O=.7,H=30,S=100,j="rgba(0, 0, 0, 0.97)",P={};return f.release=function(){T=[]},f.randomize=function(t){var a,n,e=0;do{a=Math.round(Math.floor(Math.random()*k)),n=Math.round(Math.floor(Math.random()*D))}while(null===f(a,n)[2]&&e++<30);return t.x=a,t.y=n,t},P.start=v,P.stop=m,P.config=s,P.setData=g,P.isReady=p,P}();