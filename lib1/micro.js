var µ=function(){"use strict";function t(t){return!!t}function e(t){return null!==t&&void 0!==t}function n(t,n){return e(t)?t:n}function r(t,e){var n=t-e*Math.floor(t/e);return n===e?0:n}function o(t,e){var n=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(n*n+r*r)}function i(t,e,n){return Math.max(e,Math.min(t,n))}function a(t,e,n){return(µ.clamp(t,e,n)-e)/(n-e)}function u(t,e,n){return t*(n-e)+e}function c(t,e){var n=t.toString(),r=Math.max(e-n.length,0);return new Array(r+1).join("0")+n}function s(t){return 0===t.length?t:t.charAt(0).toUpperCase()+t.substr(1)}function l(){return/firefox/i.test(navigator.userAgent)}function f(){return/android|blackberry|iemobile|ipad|iphone|ipod|opera mini|webos/i.test(navigator.userAgent)}function d(){return window!=window.top}function h(t){return t.getUTCFullYear()+"-"+c(t.getUTCMonth()+1,2)+"-"+c(t.getUTCDate(),2)+" "+c(t.getUTCHours(),2)+":00"}function g(t){return t.getFullYear()+"-"+c(t.getMonth()+1,2)+"-"+c(t.getDate(),2)+" "+c(t.getHours(),2)+":00"}function v(t,e,n){if(!e)return t.substr(0,4)+n+t.substr(4,2)+n+t.substr(6,2);var r=t.substr(0,10).split(e);return[r[0],r[1],r[2]].join(n)}function p(t,e){return v(t.toISOString(),"-",e||"")}function m(t){return{date:µ.dateToUTCymd(t,"/"),hour:µ.zeroPad(t.getUTCHours(),2)+"00"}}function w(){function t(t){return t&&t.stack?t+"\n"+t.stack:t}return{debug:function(e){console&&console.log&&console.log(t(e))},info:function(e){console&&console.info&&console.info(t(e))},error:function(e){console&&console.error&&console.error(t(e))},time:function(e){console&&console.time&&console.time(t(e))},timeEnd:function(e){console&&console.timeEnd&&console.timeEnd(t(e))}}}function y(){var t=window,e=document&&document.documentElement,n=document&&document.getElementsByTagName("body")[0];return{width:t.innerWidth||e.clientWidth||n.clientWidth,height:t.innerHeight||e.clientHeight||n.clientHeight}}function M(t){for(;t.firstChild;)t.removeChild(t.firstChild)}function b(t){return t.getContext("2d").clearRect(0,0,t.width,t.height),t}function C(t,e){var n=t[0],r=t[1],o=t[2],i=e[0]-n,a=e[1]-r,u=e[2]-o;return function(t,e){return[Math.floor(n+t*i),Math.floor(r+t*a),Math.floor(o+t*u),e]}}function x(t,e){var n=t*A*5/6;n*=.75;var r=Math.sin(n),o=Math.cos(n);return[Math.floor(255*Math.max(0,-o)),Math.floor(255*Math.max(r,0)),Math.floor(255*Math.max(o,0,-r)),e]}function T(t,e){return t<=B?x(t/B,e):G((t-B)/(1-B),e)}function j(t,e,n,r){return"rgba("+t+", "+e+", "+n+", "+r+")"}function E(t,e){for(var n=[],r=85;r<=255;r+=t)n.push(j(r,r,r,1));return n.indexFor=function(t){return Math.floor(Math.min(t,e)/e*(n.length-1))},n}function H(t){for(var e=[],n=[],r=[],o=0;o<t.length-1;o++)e.push(t[o+1][0]),n.push(C(t[o][1],t[o+1][1])),r.push([t[o][0],t[o+1][0]]);return function(t,o){var i;for(i=0;i<e.length-1&&!(t<=e[i]);i++);var a=r[i];return n[i](µ.proportion(t,a[0],a[1]),o)}}function F(t,e){return Math.abs(e).toFixed(2)+"° "+(e>=0?"N":"S")+", "+Math.abs(t).toFixed(2)+"° "+(t>=0?"E":"W")}function S(t,e){return e.conversion(t).toFixed(e.precision)}function N(t,e){var n=Math.atan2(-t[0],-t[1])/A*360;return(5*Math.round((n+360)%360/5)).toFixed(0)+"° @ "+S(t[2],e)}function U(t){var e=when.defer();return d3.json(t,function(n,r){return n?n.status?e.reject({status:n.status,message:n.statusText,resource:t}):e.reject({status:-1,message:"Cannot load resource: "+t,resource:t}):e.resolve(r)}),e.promise}function I(t,e,n,r,o){var i=e<0?W:-W,a=n<0?W:-W,u=t([e+i,n]),c=t([e,n+a]),s=Math.cos(n/360*A);return[(u[0]-r)/i/s,(u[1]-o)/i/s,(c[0]-r)/a,(c[1]-o)/a]}function k(t){function e(){return function t(){return t.requested=!0,i}}function n(t,e){function n(e){return t.requested?null:_.isFunction(c)?c.apply(i,e):c}function o(e){t.requested||(r=e,i.trigger("update",e,i))}function a(e){t.requested||i.trigger("reject",e,i)}function u(t){i.trigger("fail",t,i)}try{var c=e[0];when.all(_.rest(e)).then(n).then(o,a).done(void 0,u),i.trigger("submit",i)}catch(t){u(t)}}var r=t,o=_.debounce(n,0),i={value:function(){return r},cancel:e(),submit:function(t,n,r,i){return this.cancel(),o(this.cancel=e(),arguments),this}};return _.extend(i,Backbone.Events)}function P(t,r,o){var i,a={},u=/^(current|(\d{4})\/(\d{1,2})\/(\d{1,2})\/(\d{3,4})Z)\/(\w+)\/(\w+)\/(\w+)([\/].+)?/.exec(t);if(u){var s="current"===u[1]?"current":u[2]+"/"+c(u[3],2)+"/"+c(u[4],2),l=e(u[5])?c(u[5],4):"";a={date:s,hour:l,param:u[6],surface:u[7],level:u[8],projection:"orthographic",orientation:"",topology:z,overlayType:"default",showGridPoints:!1},n(u[9],"").split("/").forEach(function(t){(i=/^(\w+)(=([\d\-.,]*))?$/.exec(t))?r.has(i[1])&&(a.projection=i[1],a.orientation=n(i[3],"")):(i=/^overlay=(\w+)$/.exec(t))?(o.has(i[1])||"default"===i[1])&&(a.overlayType=i[1]):(i=/^grid=(\w+)$/.exec(t))&&"on"===i[1]&&(a.showGridPoints=!0)})}return a}function q(t,e){var n=new O;return n._projectionNames=t,n._overlayTypes=e,n}var A=2*Math.PI,W=36e-6,z=f()?"/data/earth-topo-mobile.json?v2":"/data/earth-topo.json?v2",B=.45,G=C(x(1,0),[255,255,255]),O=Backbone.Model.extend({id:0,_ignoreNextHashChangeEvent:!1,_projectionNames:null,_overlayTypes:null,toHash:function(){var n=this.attributes,r="current"===n.date?"current":n.date+"/"+n.hour+"Z",o=[n.projection,n.orientation].filter(t).join("="),i=e(n.overlayType)&&"default"!==n.overlayType?"overlay="+n.overlayType:"",a=n.showGridPoints?"grid=on":"";return[r,n.param,n.surface,n.level,i,o,a].filter(t).join("/")},sync:function(t,e,n){switch(t){case"read":if("hashchange"===n.trigger&&e._ignoreNextHashChangeEvent)return void(e._ignoreNextHashChangeEvent=!1);e.set(P(window.location.hash.substr(1)||"current/wind/surface/level/orthographic",e._projectionNames,e._overlayTypes));break;case"update":e._ignoreNextHashChangeEvent=!0,window.location.hash=e.toHash()}}});return{isTruthy:t,isValue:e,coalesce:n,floorMod:r,distance:o,clamp:i,proportion:a,spread:u,zeroPad:c,capitalize:s,isFF:l,isMobile:f,isEmbeddedInIFrame:d,toUTCISO:h,toLocalISO:g,ymdRedelimit:v,dateToUTCymd:p,dateToConfig:m,log:w,view:y,removeChildren:M,clearCanvas:b,sinebowColor:x,extendedSinebowColor:T,windIntensityColorScale:E,segmentedColorScale:H,formatCoordinates:F,formatScalar:S,formatVector:N,loadJson:U,distortion:I,newAgent:k,parse:P,buildConfiguration:q}}();