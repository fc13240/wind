var products=function(){"use strict";function e(e){return new Promise(function(n,t){$.getJSON(e,function(e){n(e)}).error(function(n){t({status:n.status,message:n.message,resource:e})})})}function n(n){return _.extend({description:"",paths:[],date:null,navigate:function(e){return a(this.date,e)},load:function(n){var t=this;return when.map(this.paths,e).then(function(e){return n.requested?null:_.extend(t,h(t.builder.apply(t,e)))})}},n)}function t(e,n,t,r){var a=e.date,i="current"===a?"current":e.hour,o=[i,n,t,r,"gfs","1.0"].filter(µ.isValue).join("-")+".json";return[b,a,o].join("/")}function r(e){if("current"===e.date){var n=new Date(Date.now()),t=Math.floor(n.getUTCHours()/3);return new Date(Date.UTC(n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate(),t))}var r=e.date.split("/");return new Date(Date.UTC(+r[0],r[1]-1,+r[2],+e.hour.substr(0,2)))}function a(e,n){var t=3*(n>1?8:n<-1?-8:n),r=new Date(e);return r.setHours(r.getHours()+t),r}function i(e,n,t,r){return{lo1:t.sequence.start,la1:n.sequence.start,dx:t.sequence.delta,dy:-n.sequence.delta,nx:t.sequence.size,ny:n.sequence.size,refTime:e.data[0],forecastTime:0,centerName:r}}function o(e){return"surface"===e.surface?"Surface":µ.capitalize(e.level)}function u(e){return"surface"===e.surface?"地上":µ.capitalize(e.level)}function c(e){return function(n){var t={};return _.each(e,function(e,r){t[r]=e[n]||e.en||e}),t}}function l(e,n,t){if(t=+t||0,"current"===n)return e[e.length-1+t];var r=µ.ymdRedelimit(n,"/",""),a=_.sortedIndex(e,r);return a=0===(e[a]||"").indexOf(r)?a:a-1,e[a+t]}function s(e,n){var t=l(e,n.date);return t?[g,t].join("/"):null}function d(e,n){var t=l(e,n.date),r=t?µ.ymdRedelimit(t,"","/").split("/"):null;return r?new Date(Date.UTC(+r[0],r[1]-1,+r[2],0)):null}function f(e,n,t){var r=l(e,µ.dateToUTCymd(n,"/"),t>1?6:t<-1?-6:t),a=r?µ.ymdRedelimit(r,"","/").split("/"):null;return a?new Date(Date.UTC(+a[0],a[1]-1,+a[2],0)):null}function p(e){switch(e.center||e.centerName){case-3:return"OSCAR / Earth & Space Research";case 7:case"US National Weather Service, National Centres for Environmental Prediction (NCEP)":return"GFS / NCEP / US National Weather Service";default:return e.centerName}}function m(e,n,t,r,a,i){var o=1-e,u=1-n;return t*o*u+r*e*u+a*o*n+i*e*n}function v(e,n,t,r,a,i){var o=1-e,u=1-n,c=o*u,l=e*u,s=o*n,d=e*n,f=t[0]*c+r[0]*l+a[0]*s+i[0]*d,p=t[1]*c+r[1]*l+a[1]*s+i[1]*d;return[f,p,Math.sqrt(f*f+p*p)]}function h(e){function n(n,t){var u,c=µ.floorMod(n-r,360)/i,l=(a-t)/o,d=Math.floor(c),f=d+1,p=Math.floor(l),m=p+1;if(u=s[p]){var v=u[d],h=u[f];if(µ.isValue(v)&&µ.isValue(h)&&(u=s[m])){var _=u[d],y=u[f];if(µ.isValue(_)&&µ.isValue(y))return e.interpolate(c-d,l-p,v,h,_,y)}}return null}var t=e.header,r=t.lo1,a=t.la1,i=t.dx,o=t.dy,u=t.nx,c=t.ny,l=new Date(t.refTime);l.setHours(l.getHours()+t.forecastTime);for(var s=[],d=0,f=Math.floor(u*i)>=360,m=0;m<c;m++){for(var v=[],h=0;h<u;h++,d++)v[h]=e.data(d);f&&v.push(v[0]),s[m]=v}return{source:p(t),date:l,interpolate:n,forEachPoint:function(e){for(var n=0;n<c;n++)for(var t=s[n]||[],l=0;l<u;l++)e(µ.floorMod(180+r+l*i,360)-180,a-n*o,t[l])}}}function y(e){var n=_.clone(e),t=[];return _.values(C).forEach(function(e){e.matches(n)&&t.push(e.create(n))}),t.filter(µ.isValue)}var b="./data/weather",g="./data/oscar",w={oscar:e([g,"catalog.json"].join("/"))},C={wind:{matches:_.matches({param:"wind"}),create:function(e){return n({field:"vector",type:"wind",description:c({name:{en:"Wind",ja:"風速"},qualifier:{en:" @ "+o(e),ja:" @ "+u(e)}}),paths:[t(e,"wind",e.surface,e.level)],date:r(e),builder:function(e){var n=e[0].data,t=e[1].data;return{header:e[0].header,interpolate:v,data:function(e){return[n[e],t[e]]}}},units:[{label:"km/h",conversion:function(e){return 3.6*e},precision:0},{label:"m/s",conversion:function(e){return e},precision:1},{label:"kn",conversion:function(e){return 1.943844*e},precision:0},{label:"mph",conversion:function(e){return 2.236936*e},precision:0}],scale:{bounds:[0,100],gradient:function(e,n){return µ.extendedSinebowColor(Math.min(e,100)/100,n)}},particles:{velocityScale:1e-4,maxIntensity:17}})}},temp:{matches:_.matches({param:"wind",overlayType:"temp"}),create:function(e){return n({field:"scalar",type:"temp",description:c({name:{en:"Temp",ja:"気温"},qualifier:{en:" @ "+o(e),ja:" @ "+u(e)}}),paths:[t(e,"temp",e.surface,e.level)],date:r(e),builder:function(e){var n=e[0],t=n.data;return{header:n.header,interpolate:m,data:function(e){return t[e]}}},units:[{label:"°C",conversion:function(e){return e-273.15},precision:1},{label:"°F",conversion:function(e){return 9*e/5-459.67},precision:1},{label:"K",conversion:function(e){return e},precision:1}],scale:{bounds:[193,328],gradient:µ.segmentedColorScale([[193,[37,4,42]],[206,[41,10,130]],[219,[81,40,40]],[233.15,[192,37,149]],[255.372,[70,215,215]],[273.15,[21,84,187]],[275.15,[24,132,14]],[291,[247,251,59]],[298,[235,167,21]],[311,[230,71,39]],[328,[88,27,67]]])}})}},relative_humidity:{matches:_.matches({param:"wind",overlayType:"relative_humidity"}),create:function(e){return n({field:"scalar",type:"relative_humidity",description:c({name:{en:"Relative Humidity",ja:"相対湿度"},qualifier:{en:" @ "+o(e),ja:" @ "+u(e)}}),paths:[t(e,"relative_humidity",e.surface,e.level)],date:r(e),builder:function(e){var n=e.variables,t=n.Relative_humidity_isobaric||n.Relative_humidity_height_above_ground,r=t.data;return{header:i(n.time,n.lat,n.lon,e.Originating_or_generating_Center),interpolate:m,data:function(e){return r[e]}}},units:[{label:"%",conversion:function(e){return e},precision:0}],scale:{bounds:[0,100],gradient:function(e,n){return µ.sinebowColor(Math.min(e,100)/100,n)}}})}},air_density:{matches:_.matches({param:"wind",overlayType:"air_density"}),create:function(e){return n({field:"scalar",type:"air_density",description:c({name:{en:"Air Density",ja:"空気密度"},qualifier:{en:" @ "+o(e),ja:" @ "+u(e)}}),paths:[t(e,"air_density",e.surface,e.level)],date:r(e),builder:function(e){var n=e.variables,t=n.air_density,r=t.data;return{header:i(n.time,n.lat,n.lon,e.Originating_or_generating_Center),interpolate:m,data:function(e){return r[e]}}},units:[{label:"kg/m³",conversion:function(e){return e},precision:2}],scale:{bounds:[0,1.5],gradient:function(e,n){return µ.sinebowColor(Math.min(e,1.5)/1.5,n)}}})}},wind_power_density:{matches:_.matches({param:"wind",overlayType:"wind_power_density"}),create:function(e){var t=C.wind.create(e),a=C.air_density.create(e);return n({field:"scalar",type:"wind_power_density",description:c({name:{en:"Wind Power Density",ja:"風力エネルギー密度"},qualifier:{en:" @ "+o(e),ja:" @ "+u(e)}}),paths:[t.paths[0],a.paths[0]],date:r(e),builder:function(e,n){var r=t.builder(e),i=a.builder(n),o=r.data,u=r.interpolate,c=i.data,l=i.interpolate;return{header:_.clone(i.header),interpolate:function(e,n,t,r,a,i){var o=u(e,n,t[0],r[0],a[0],i[0])[2];return.5*l(e,n,t[1],r[1],a[1],i[1])*o*o*o},data:function(e){return[o(e),c(e)]}}},units:[{label:"kW/m²",conversion:function(e){return e/1e3},precision:1},{label:"W/m²",conversion:function(e){return e},precision:0}],scale:{bounds:[0,8e4],gradient:µ.segmentedColorScale([[0,[15,4,96]],[250,[30,8,180]],[1e3,[121,102,2]],[2e3,[118,161,66]],[4e3,[50,102,219]],[8e3,[19,131,193]],[16e3,[59,204,227]],[64e3,[241,1,45]],[8e4,[243,0,241]]])}})}},total_cloud_water:{matches:_.matches({param:"wind",overlayType:"total_cloud_water"}),create:function(e){return n({field:"scalar",type:"total_cloud_water",description:c({name:{en:"Total Cloud Water",ja:"雲水量"},qualifier:""}),paths:[t(e,"total_cloud_water")],date:r(e),builder:function(e){var n=e[0],t=n.data;return{header:n.header,interpolate:m,data:function(e){return t[e]}}},units:[{label:"kg/m²",conversion:function(e){return e},precision:3}],scale:{bounds:[0,1],gradient:µ.segmentedColorScale([[0,[5,5,89]],[.2,[170,170,230]],[1,[255,255,255]]])}})}},total_precipitable_water:{matches:_.matches({param:"wind",overlayType:"total_precipitable_water"}),create:function(e){return n({field:"scalar",type:"total_precipitable_water",description:c({name:{en:"Total Precipitable Water",ja:"可降水量"},qualifier:""}),paths:[t(e,"total_precipitable_water")],date:r(e),builder:function(e){var n=e[0],t=n.data;return{header:n.header,interpolate:m,data:function(e){return t[e]}}},units:[{label:"kg/m²",conversion:function(e){return e},precision:3}],scale:{bounds:[0,70],gradient:µ.segmentedColorScale([[0,[230,165,30]],[10,[120,100,95]],[20,[40,44,92]],[30,[21,13,193]],[40,[75,63,235]],[60,[25,255,255]],[70,[150,255,255]]])}})}},mean_sea_level_pressure:{matches:_.matches({param:"wind",overlayType:"mean_sea_level_pressure"}),create:function(e){return n({field:"scalar",type:"mean_sea_level_pressure",description:c({name:{en:"Mean Sea Level Pressure",ja:"海面更正気圧"},qualifier:""}),paths:[t(e,"mean_sea_level_pressure")],date:r(e),builder:function(e){var n=e[0],t=n.data;return{header:n.header,interpolate:m,data:function(e){return t[e]}}},units:[{label:"hPa",conversion:function(e){return e/100},precision:0},{label:"mmHg",conversion:function(e){return e/133.322387415},precision:0},{label:"inHg",conversion:function(e){return e/3386.389},precision:1}],scale:{bounds:[92e3,105e3],gradient:µ.segmentedColorScale([[92e3,[40,0,0]],[95e3,[187,60,31]],[96500,[137,32,30]],[98e3,[16,1,43]],[100500,[36,1,93]],[101300,[241,254,18]],[103e3,[228,246,223]],[105e3,[255,255,255]]])}})}},currents:{matches:_.matches({param:"ocean",surface:"surface",level:"currents"}),create:function(e){return when(w.oscar).then(function(t){return n({field:"vector",type:"currents",description:c({name:{en:"Ocean Currents",ja:"海流"},qualifier:{en:" @ Surface",ja:" @ 地上"}}),paths:[s(t,e)],date:d(t,e),navigate:function(e){return f(t,this.date,e)},builder:function(e){var n=e[0].data,t=e[1].data;return{header:e[0].header,interpolate:v,data:function(e){var r=n[e],a=t[e];return µ.isValue(r)&&µ.isValue(a)?[r,a]:null}}},units:[{label:"m/s",conversion:function(e){return e},precision:2},{label:"km/h",conversion:function(e){return 3.6*e},precision:1},{label:"kn",conversion:function(e){return 1.943844*e},precision:1},{label:"mph",conversion:function(e){return 2.236936*e},precision:1}],scale:{bounds:[0,1.5],gradient:µ.segmentedColorScale([[0,[10,25,68]],[.15,[10,25,250]],[.4,[24,255,93]],[.65,[255,233,102]],[1,[255,233,15]],[1.5,[255,15,15]]])},particles:{velocityScale:1/4400,maxIntensity:.7}})})}},off:{matches:_.matches({overlayType:"off"}),create:function(){return null}}};return{overlayTypes:function(){var e={};return _.each(_.keys(C),function(n){e[n]=!0}),e}(),productsFor:y}}();