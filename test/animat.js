function animate(e,t,i){function n(){c.forEach(function(e){e.length=0}),E.forEach(function(e){e.age>MAX_PARTICLE_AGE&&(t.randomize(e).age=0);var i=e.x,n=e.y,o=t(i,n),a=o[2];if(null===a)e.age=MAX_PARTICLE_AGE;else{var r=i+o[0],f=n+o[1];t.isDefined(r,f)?(e.xt=r,e.yt=f,c[l.indexFor(a)].push(e)):(e.x=r,e.y=f)}e.age+=1})}function o(){var e=d.globalCompositeOperation;d.globalCompositeOperation="destination-in",d.fillRect(r.x,r.y,r.width,r.height),d.globalCompositeOperation=e,c.forEach(function(e,t){e.length>0&&(d.beginPath(),d.strokeStyle=l[t],d.strokeStyle="#fff",e.forEach(function(e){d.moveTo(e.x,e.y),d.lineTo(e.xt,e.yt),e.x=e.xt,e.y=e.yt}),d.stroke())})}if(e&&t&&i){var a=this.cancel,r=e.bounds(view),l=µ.windIntensityColorScale(INTENSITY_SCALE_STEP,i.primaryGrid.particles.maxIntensity),c=l.map(function(){return[]}),f=Math.round(r.width*PARTICLE_MULTIPLIER);µ.isMobile()&&(f*=PARTICLE_REDUCTION);var s=µ.isFF()?"rgba(0, 0, 0, 0.95)":"rgba(0, 0, 0, 0.97)";console.debug("particle count: "+f);for(var E=[],u=0;u<f;u++)E.push(t.randomize({age:_.random(0,MAX_PARTICLE_AGE)}));var d=animateCanvas.getContext("2d");d.lineWidth=PARTICLE_LINE_WIDTH,d.fillStyle=s,function e(){try{if(a.requested)return void t.release();n(),o(),setTimeout(e,FRAME_RATE)}catch(e){report.error(e)}}()}}